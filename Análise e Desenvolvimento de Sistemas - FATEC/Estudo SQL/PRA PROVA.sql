
--CRIAÇÃO DA TABELA ---

CREATE DATABASE LOJA
GO
USE LOJA


CREATE TABLE CLIENTE(
	IDCLIENTE INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	CPF BIGINT,
	DATANASC DATETIME,
	NOMECLI VARCHAR(50),
	SEXO CHAR(1),
	STATUS CHAR(1)
)

CREATE TABLE VENDA(
	IDVENDA INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	DATAVENDA DATETIME,
	DATAPAG DATETIME,
	IDCLIENTE INT REFERENCES CLIENTE (IDCLIENTE)
)

CREATE TABLE MARCA(
	IDMARCA INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	NOMEMARCA VARCHAR(50)
)

CREATE TABLE TIPOPROD(
	IDTIPO INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	NOMETIPO VARCHAR(50)
)

CREATE TABLE PRODUTO(
	IDPRODUTO INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	NOMEPROD VARCHAR(50),
	VALORVEN DECIMAL(15,2),
	IDTIPO INT REFERENCES TIPOPROD (IDTIPO),
	IDMARCA INT REFERENCES MARCA (IDMARCA)
)

CREATE TABLE COMPRA(
	IDCOMPRA INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	QUANTIDADE INT,
	VALORCOMP DECIMAL(15,2),
	IDPRODUTO INT REFERENCES PRODUTO (IDPRODUTO)
)

CREATE TABLE ITEMVENDA(
	IDITEM INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	QTD INT,
	IDVENDA INT NOT NULL REFERENCES VENDA(IDVENDA),
	IDPRODUTO INT NOT NULL REFERENCES PRODUTO(IDPRODUTO)
)




----------------------------------EXERCICIOS----------------------------------------------------------------

--04- Popular da base - > Crie 15 clientes. OBS: Deixe alguns Clientes com status de inativo

INSERT INTO CLIENTE (CPF,NOMECLI,DATANASC,SEXO,STATUS)
VALUES	(02925111084,'MARCELO CAMPOS SANTOS',			'06-12-1991','M','A'),
		(22629446018,'LUCAS JOSÉ BARBOSA SILVA',		'03-12-1991','M','A'),
		(49272617006,'LUCAS LARA VIEIRA PINTO',			'03-09-1991','M','A'),
		(38000278014,'LIVIA MARA DA COSTA MAGALHAES',	'01-02-1992','F','I'),
		(95074126037,'RAFAEL AUGUSTO SILVA',			'01-03-1992','M','A'),
		(78673359007,'ANDRE LUIS MUNHOZ JUNIOR',		'04-07-1993','M','I'),
		(11179438019,'CARLOS ALBERTO DE NOBREGA',		'31-12-1992','M','A'),
		(39133360014,'PEDRO PAULO CARLOS SILVA',		'01-02-1992','F','I'),
		(98817533092,'JOAO KLEBER',						'24-07-1988','M','I'),
		(83738332006,'JOAO DO PÉ DE FEIJÃO',			'30-12-1987','M','I'),
		(50106032097,'FERNANDO DE PAULA',				'06-01-1992','M','A'),
		(42597201040,'JOAQUIM CANDIDO PORTUGAL',		'12-04-1954','M','I'),
		(68224330079,'ANTONIA DAS DORES',				'12-11-1970','F','I'),
		(12135729086,'JOSE PEDRO DE LARA',				'12-08-1980','M','A'),
		(51810299063,'MARCIA DE ABREU',					'01-02-1988','F','I')

-- 05- Popular da base - > Criar os tipos de produto e marcas ( no mínimo 4 diferentes).

INSERT INTO MARCA(NOMEMARCA)
VALUES ('SAMSUNG'),
	   ('MOTOROLA'),       
	   ('APPLE'),
	   ('NOKIA'),
	   ('NEXTEL')


INSERT INTO TIPOPROD(NOMETIPO)
VALUES		('SMARTPHONE'),
			('TV'),                            
			('NOTEBOOK')

-- 06- Popular da base - > Criar no mínimo 20 produtos diferentes.


INSERT INTO PRODUTO (NOMEPROD,VALORVEN,IDTIPO,IDMARCA)
VALUES		('IPHONE X',			5000,1,3),
			('GALAXY S10',			6000,1,1),
			('INDESTRUTIVEL 1',		3000,1,4),
			('NEX1',				1000,1,5),
			('MOTO C',				100,1,2),
			('MOTO X',				3290,1,2),
			('IPHONE 7',			4000,1,3),
			('IPHONE 6',			3000,1,3),
			('GALAXY 1',			100,1,1),
			('INDESTRUTIVEL 2',		4000,1,4),
			('SMART LOKA 3000',		5000,2,1),
			('ISMART2',				5000,2,3),
			('ROCHA 1',				2000,2,4),
			('MACBOOK',				8000,3,3),
			('TRAVOBOOK',			3999,3,1),
			('ARMA',				9000,3,4),
			('IPHONE 3',			1200,1,3),
			('GALAXY 1',			1200,1,1),
			('INDESTRUTIVEL 3',		2333,1,4),
			('NEX33',				2500,1,5)

--07- Popular da base - > Criar 20 vendas diferentes. (Não se esqueça de criar os itens das vendas)
--OBS: Deixe alguns produtos e clientes sem venda e algumas vendas sem data de pagamento.
INSERT INTO VENDA (DATAVENDA,IDCLIENTE)
VALUES		('01-01-2018',1),
			('02-01-2018',3),    --SEM DATA DE PAGAMENTO
			('03-01-2018',5),
			('04-01-2018',7),
			('05-01-2018',9)

INSERT INTO VENDA (DATAVENDA,DATAPAG,IDCLIENTE)
VALUES		('06-01-2018','06-02-2018',1),
			('07-01-2018','07-02-2018',3),    --COM DATA DE PAGAMENTO
			('08-01-2018','08-02-2018',5),
			('09-01-2018','09-02-2018',7),
			('10-01-2018','10-02-2018',9),
			('11-01-2018','11-02-2018',2),
			('12-01-2018','12-02-2018',4),    
			('13-01-2018','13-02-2018',6),
			('14-01-2018','14-02-2018',8),
			('15-01-2018','15-02-2018',10),
			('01-02-2018','01-03-2018',11),
			('02-02-2018','02-03-2018',12),    
			('03-02-2018','03-03-2018',1),
			('04-02-2018','04-03-2018',4),
			('05-07-2018','05-03-2018',6)

INSERT INTO ITEMVENDA(QTD,IDVENDA,IDPRODUTO)
VALUES		(4,1,1),
			(1,2,2),
			(3,3,3),
			(4,4,4),
			(3,5,5),
			(2,6,6),
			(1,7,7),
			(5,8,8),
			(6,9,9),
			(3,10,10),
			(7,11,11),
			(3,12,12),
			(6,13,13),
			(2,14,14),
			(1,15,15),
			(1,16,1),
			(6,17,12),
			(3,18,11),
			(2,19,10),
			(1,20,2)


--08- Liste o nome, CPF e data de Nascimento de todos os clientes.
SELECT 
NOMECLI AS NOME,CPF, DATANASC AS NASCIDO_EM
FROM CLIENTE

--09- Liste o nome, CPF e data de Nascimento de todos os clientes ativos.
SELECT NOMECLI, CPF, DATANASC
FROM CLIENTE
WHERE STATUS = 'A'

--10- Liste o nome do produto, marca, tipo de produto e valor de venda de todos os produtos.
SELECT NOMEPROD, NOMEMARCA, NOMETIPO, VALORVEN
FROM PRODUTO P INNER JOIN MARCA M ON P.IDMARCA = M.IDMARCA
			   INNER JOIN TIPOPROD AS T ON P.IDTIPO = T.IDTIPO
			   

--11- Listar o nome e CPF de todos os clientes que não compraram.
SELECT NOMECLI, CPF
FROM CLIENTE AS C LEFT JOIN VENDA AS V 
ON C.IDCLIENTE = V.IDCLIENTE
WHERE V.IDCLIENTE IS NULL

-- 12- Listar nome do produto, tipo do produto e marca de todos os produtos que não foram vendidos.
SELECT NOMEPROD, NOMETIPO, NOMEMARCA
FROM PRODUTO P INNER JOIN MARCA M ON P.IDMARCA = M.IDMARCA
			   INNER JOIN TIPOPROD AS T ON P.IDTIPO = T.IDTIPO
			   LEFT JOIN ITEMVENDA AS I ON P.IDPRODUTO = I.IDPRODUTO
			   WHERE I.IDPRODUTO IS NULL

-- 13- Listar nome, CPF e data de nascimento de todos os clientes que nasceram em julho.
SELECT NOMECLI, CPF, DATANASC
FROM CLIENTE 
WHERE MONTH(DATANASC) = 7

--14- Listar o nome do cliente e data de compra de todos os clientes que compraram nos últimos 6 meses.
SELECT distinct NOMECLI, DATAVENDA
FROM CLIENTE C INNER JOIN VENDA V ON C.IDCLIENTE = V.IDCLIENTE
WHERE V.DATAVENDA >= GETDATE() -180
ORDER BY DATAVENDA


--15- Listar nome e data de nascimento todos os clientes com idade entre 40 e 50 anos.
SELECT NOMECLI, DATANASC
FROM CLIENTE
WHERE DATEDIFF(YYYY,DataNasc, GETDATE()) BETWEEN 40 AND 50
ORDER BY NOMECLI

